<div class="attachments">
<% if @scan_result && @scan_result[:error] %>
  <div class='flash error'><%= @scan_result[:error] %></div>
<% end %>

<% if container.respond_to?(:project) && container.project.has_file_server? && ( %w"Message Board".include?( container.class.name ) == false ) %>
  <p>
    <strong><%= l(:attach_files) %></strong> (
    <% if container.is_a?(Issue) %>
      <%= container.project.file_server.autoscan ? "" : link_to(l(:attach_rescan), { controller: :issues, action: :scan_files, :id => container }, :method => :post, :remote => true ) + " / "%>
      <%= link_to(l(:attach_browse), container.alien_files_folder_url(true), :target => "_blank") %>
    <% else %>
      <%#= @project.file_server.autoscan ? "" : link_to(l(:attach_rescan), container_scan_attachments_files_path(container, :back_url => request.original_url), :method => :patch ) + " / "%>
      <%= @project.file_server.autoscan ? "" : link_to(l(:attach_rescan), object_scan_attachments_files_path(container.class.name.underscore.pluralize, container.id, :back_url => request.original_url), :method => :patch ) + " / "%>
      <%#= link_to(l(:attach_browse), container_browse_attachments_files_path(container), :target => "_blank") %>
      <%= link_to(l(:attach_browse), container.project.file_server.ftpurl_for(Attachment.object_scan_path(container),true,false), :target => "_blank") %>
    <% end %>
  )</p>
<% end %>

<div class="contextual">
  <%= link_to image_tag('edit.png'),
        container_attachments_edit_path(container),
        :title => l(:label_edit_attachments) if options[:editable] %>
</div>
<% for attachment in attachments %>
<p><%= link_to_attachment attachment, :class => 'icon icon-attachment', :download => true -%>
  <% if attachment.is_text? %>
    <%= link_to image_tag('magnifier.png'),
                :controller => 'attachments', :action => 'show',
                :id => attachment, :filename => attachment.filename %>
  <% end %>
  <%= h(" - #{attachment.description}") unless attachment.description.blank? %>
  <span class="size">(<%= number_to_human_size attachment.filesize %>)</span>
  <% if options[:deletable] %>
    <%= link_to image_tag('delete.png'), attachment_path(attachment),
                                         :data => {:confirm => l(:text_are_you_sure)},
                                         :method => :delete,
                                         :class => 'delete',
                                         :title => l(:button_delete) %>
  <% end %>
  <% if options[:author] %>
    <span class="author"><%= h(attachment.author) %>, <%= format_time(attachment.created_on) %></span>
  <% end %>
  <%= " (manually uploaded)" if attachment.author_id == 0 %>
  <%= image_tag('/plugin_assets/file_servers/images/new.png') if @scan_result && @scan_result[:new].include?(attachment) %>
  </p>
<% end %>
<% if defined?(thumbnails) && thumbnails %>
  <% images = attachments.select(&:thumbnailable?) %>
  <% if images.any? %>
  <div class="thumbnails">
    <% images.each do |attachment| %>
      <div><%= thumbnail_tag(attachment) %></div>
    <% end %>
  </div>
  <% end %>
<% end %>
</div>
